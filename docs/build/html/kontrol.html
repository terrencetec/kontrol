

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kontrol &mdash; Python Kontrol Library 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contact" href="contact.html" />
    <link rel="prev" title="Library Reference" href="modules.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Python Kontrol Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Library Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kontrol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subpackages">Subpackages</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol.fakeezca">kontrol.fakeezca module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol.filters">kontrol.filters module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol.optimize">kontrol.optimize module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol.unsorted">kontrol.unsorted module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol.utils">kontrol.utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol.visutils">kontrol.visutils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-kontrol">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python Kontrol Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">Library Reference</a> &raquo;</li>
        
      <li>Kontrol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/kontrol.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kontrol">
<h1>Kontrol<a class="headerlink" href="#kontrol" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-kontrol.fakeezca">
<span id="kontrol-fakeezca-module"></span><h2>kontrol.fakeezca module<a class="headerlink" href="#module-kontrol.fakeezca" title="Permalink to this headline">¶</a></h2>
<p>Fake guardian module with dummy Ezca class for debugging on non-CDS machines</p>
<dl class="py class">
<dt id="kontrol.fakeezca.Ezca">
<em class="property">class </em><code class="sig-prename descclassname">kontrol.fakeezca.</code><code class="sig-name descname">Ezca</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prefix</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.fakeezca.Ezca" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py class">
<dt id="kontrol.fakeezca.Ezca.Device">
<em class="property">class </em><code class="sig-name descname">Device</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prefix</span></em>, <em class="sig-param"><span class="n">delim</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.fakeezca.Ezca.Device" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py method">
<dt id="kontrol.fakeezca.Ezca.read">
<code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">channel</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.fakeezca.Ezca.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read channel value.</p>
</dd></dl>

<dl class="py method">
<dt id="kontrol.fakeezca.Ezca.switch">
<code class="sig-name descname">switch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sfmname</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.fakeezca.Ezca.switch" title="Permalink to this definition">¶</a></dt>
<dd><p>Manipulate buttons in CDS Standard Filter Module (SFM).</p>
</dd></dl>

<dl class="py method">
<dt id="kontrol.fakeezca.Ezca.write">
<code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">channel</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.fakeezca.Ezca.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write value channel to channel.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-kontrol.filters">
<span id="kontrol-filters-module"></span><h2>kontrol.filters module<a class="headerlink" href="#module-kontrol.filters" title="Permalink to this headline">¶</a></h2>
<p>Standard filter references.</p>
<dl class="py function">
<dt id="kontrol.filters.complementary_modified_sekiguchi">
<code class="sig-prename descclassname">kontrol.filters.</code><code class="sig-name descname">complementary_modified_sekiguchi</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coefs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.filters.complementary_modified_sekiguchi" title="Permalink to this definition">¶</a></dt>
<dd><p>Modified Sekiguchi Filter with guaranteed 4th-order high-pass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>coefs</strong> (<em>list of</em><em> (</em><em>int</em><em> or </em><em>float</em><em>) or </em><em>numpy.ndarray</em>) – 4 coefficients defining the modified Sekiguchi filter.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>lpf</strong> (<em>control.xferfcn.TransferFunction</em>) – Complementary low-pass filter</p></li>
<li><p><strong>hpf</strong> (<em>control.xferfcn.Transferfunction</em>) – Complementary high-pass filter</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The modified Sekiguchi complemetary filter is structured as:</p>
<div class="math notranslate nohighlight">
\[H = \frac{s^7 + 7a_1s^6 + 21a_2^2s^5 + 35a_3^3s^4}{(s+a_4)^7}\]</div>
<p>where <span class="math notranslate nohighlight">\(a_1\)</span>, <span class="math notranslate nohighlight">\(a_2\)</span>, <span class="math notranslate nohighlight">\(a_3\)</span>, <span class="math notranslate nohighlight">\(a_4\)</span> are some
parameters that defines the filter.</p>
</dd></dl>

<dl class="py function">
<dt id="kontrol.filters.complementary_sekiguchi">
<code class="sig-prename descclassname">kontrol.filters.</code><code class="sig-name descname">complementary_sekiguchi</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coefs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.filters.complementary_sekiguchi" title="Permalink to this definition">¶</a></dt>
<dd><p>4th-order complementary filters specified by the blending frequencies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>coefs</strong> (<em>float</em>) – Blending frequency of the filter in [rad/s]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>lpf</strong> (<em>control.xferfcn.TransferFunction</em>) – Complementary low pass-filter</p></li>
<li><p><strong>hpf</strong> (<em>control.xferfcn.Transferfunction</em>) – Complementary high pass-filter</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>4th-order complemetary filter used in Sekiguchi’s
thesis <a class="footnote-reference brackets" href="#id2" id="id1">1</a> whose high-pass is structured as:</p>
<div class="math notranslate nohighlight">
\[H = \frac{s^7 + 7w_bs^6 + 21w_b^2s^5 + 35w_b^3s^4}{(s+w_b)^7}\]</div>
<p>where <span class="math notranslate nohighlight">\(w_b\)</span> is the blending frequency in [rad/s].</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>T. Sekiguchi, A Study of Low Frequency Vibration Isolation System
for Large Scale Gravitational Wave Detectors</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="kontrol.filters.your_custom_filter">
<code class="sig-prename descclassname">kontrol.filters.</code><code class="sig-name descname">your_custom_filter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coefs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.filters.your_custom_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Define any filter using this suggested format.</p>
</dd></dl>

</div>
<div class="section" id="module-kontrol.optimize">
<span id="kontrol-optimize-module"></span><h2>kontrol.optimize module<a class="headerlink" href="#module-kontrol.optimize" title="Permalink to this headline">¶</a></h2>
<p>Optimization related control stuff.</p>
<p>This is an ad hoc premature filter optimization python package for designing
and optimization of digital filters.</p>
<dl class="py function">
<dt id="kontrol.optimize.optimize_complementary_filter">
<code class="sig-prename descclassname">kontrol.optimize.</code><code class="sig-name descname">optimize_complementary_filter</code><span class="sig-paren">(</span><em class="sig-param">complementary_filter</em>, <em class="sig-param">spectra</em>, <em class="sig-param">f</em>, <em class="sig-param">method=&lt;function differential_evolution&gt;</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">x0=None</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.optimize.optimize_complementary_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Complementary filter optimization given noise spectra.</p>
<p>Take a filter function (returns (lpf, hpf)) and bounds of the filter
coefficients, the spectrum contents that goes through the complementary
filters and the frequency axis of the spectra. This function will minimize
the 2-norm of the overall spectra and returns the coefficients of the
filters which do that.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>complementary_filter</strong> (<em>tuple of</em><em> (</em><em>control.xferfcn.TransferFunction</em><em>, </em><em>)</em>) – A function that returns a tuple of the list of complementary             filters.</p></li>
<li><p><strong>spectra</strong> (<em>list of</em><em> [</em><em>list</em><em> or </em><em>numpy.ndarray</em><em>, </em><em>]</em>) – The frequency dependent contents that are filtered by the             complementary filters with indice matching that of             complementary_filter. Each spectrum must have the same length as             each other and must have the same length as the frequency axis f.</p></li>
<li><p><strong>f</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – The frequency axis of the spectra.</p></li>
<li><p><strong>method</strong> (<em>function</em><em>, </em><em>optional</em>) – The function that takes a cost function and minimizes it.             Examples would be scipy.optimize.minimize(),             scipy.optimize.dual_annealing(),             and scipy.optimize.differential_evolution().</p></li>
<li><p><strong>bounds</strong> (<em>list of tuple of</em><em> (</em><em>float</em><em>, </em><em>float</em><em>)</em><em>, </em><em>optional</em>) – The numerical boundaries of the coefficients that define the             filters. E.g. [(0, 1), (0, 2), ].</p></li>
<li><p><strong>x0</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em><em>, </em><em>optional</em>) – The initial guess of the filter arguments.</p></li>
<li><p><strong>*args</strong> – Variable length arguments list</p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments that also goes to the method.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>result</strong> – The optimization result in scipy optimization result format.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>scipy.optimize.OptimizeResult</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Method is automatically selected base on the
specifications of bounds and x0. If a custom method is desired,
then make sure that the arguments are correctly specfied in **kwargs
and that it takes the first argument as the cost function.
A function of the optimization that takes the format
optimization(cost_function, bounds, …).</p>
<p>I found two methods in scipy.optimize particularly useful,
dual_annealing and differential_evolution. dual_annealing is slower
for high-dimensional parameter space while differential_evolution is
generally faster but can at times trapped in local minimum near the
true optimum.</p>
<p>The function automatically detemines which minimization method to be used.
If x0 is provided, then scipy.optimize.minimize will be used if bounds are
not provided and scipy.optimize.dual_annealing will be used if bounds are
provided. Otherwise, scipy.optimize.differential_evolution will be used.</p>
</div>
</dd></dl>

</div>
<div class="section" id="module-kontrol.unsorted">
<span id="kontrol-unsorted-module"></span><h2>kontrol.unsorted module<a class="headerlink" href="#module-kontrol.unsorted" title="Permalink to this headline">¶</a></h2>
<p>Unsorted module.</p>
<p>The module now contains two LMS algorithms, lms_update() and nlms_update.</p>
<dl class="py function">
<dt id="kontrol.unsorted.lms_update">
<code class="sig-prename descclassname">kontrol.unsorted.</code><code class="sig-name descname">lms_update</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coefs</span></em>, <em class="sig-param"><span class="n">input</span></em>, <em class="sig-param"><span class="n">error</span></em>, <em class="sig-param"><span class="n">mu</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mu_limits</span><span class="o">=</span><span class="default_value">0, inf</span></em>, <em class="sig-param"><span class="n">returnmu</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">small_number</span><span class="o">=</span><span class="default_value">0.001</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.unsorted.lms_update" title="Permalink to this definition">¶</a></dt>
<dd><p>LMS algorithm.</p>
<p>Update filter coefficients/weights that minimize the mean square
error. See <a class="reference external" href="https://en.wikipedia.org/wiki/Least_mean_squares_filter">https://en.wikipedia.org/wiki/Least_mean_squares_filter</a> for
information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coefs</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – Filter coefficients/weights to be updated. Its length has to be             equal to the length of input.</p></li>
<li><p><strong>input</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – The time series data of the input. The length should be equal to             the number of taps of the FIR filter that is to be optimized.</p></li>
<li><p><strong>error</strong> (<em>float</em>) – The error to be minimzed.</p></li>
<li><p><strong>mu</strong> (<em>float</em><em>, </em><em>optional</em>) – The step size of the steepest descent algorithm. It should be             larger than zero and smaller that 1/lambda_max where lambda_max             is the larger eigenvalue of the autocorrelation matrix of the             input. if not given, then it will be estimated from the given             input.</p></li>
<li><p><strong>mu_limits</strong> (<em>tuple of</em><em> (</em><em>int</em><em> or </em><em>float</em><em>, </em><em>int of float</em><em>)</em><em>, </em><em>optional</em>) – Lower and upper limit of the step size. Defaults to be (0, np.inf)</p></li>
<li><p><strong>returnmu</strong> (<em>boolean</em><em>, </em><em>optional</em>) – If true, then return mu as well. Defaults to False.</p></li>
<li><p><strong>small_number</strong> (<em>float</em><em>, </em><em>optional</em>) – A small number to be included in the denominator to prevent             spikes when calculating the step size mu. Defaults to 1e-3.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>new_coefs</strong> (<em>numpy.ndarray</em>) – The updated filter coefficients/weights.</p></li>
<li><p><strong>mu</strong> (<em>float</em>) – The step size used in this iteration. Only returns when returnmu             is set to True.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="kontrol.unsorted.nlms_update">
<code class="sig-prename descclassname">kontrol.unsorted.</code><code class="sig-name descname">nlms_update</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coefs</span></em>, <em class="sig-param"><span class="n">input</span></em>, <em class="sig-param"><span class="n">error</span></em>, <em class="sig-param"><span class="n">mu</span><span class="o">=</span><span class="default_value">0.5</span></em>, <em class="sig-param"><span class="n">mu_limits</span><span class="o">=</span><span class="default_value">0, 1</span></em>, <em class="sig-param"><span class="n">returnmu</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">small_number</span><span class="o">=</span><span class="default_value">0.001</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.unsorted.nlms_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalized LMS algorithm. Very similar to lms_update()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coefs</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – Filter coefficients/weights to be updated. Its length has to be             equal to the length of input.</p></li>
<li><p><strong>input</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – The time series data of the input.</p></li>
<li><p><strong>error</strong> (<em>float</em>) – The error to be minimzed.</p></li>
<li><p><strong>mu</strong> (<em>float</em><em>, </em><em>optional</em>) – The step size of the steepest descent algorithm. It should be             between 0 and 1 for NLMS algorithms.</p></li>
<li><p><strong>mu_limits</strong> (<em>tuple of</em><em> (</em><em>int</em><em> or </em><em>float</em><em>, </em><em>int</em><em> or </em><em>float</em><em>)</em><em>, </em><em>optional</em>) – Lower and upper limit of the step size. Defaults to be (0, 1)</p></li>
<li><p><strong>returnmu</strong> (<em>boolean</em><em>, </em><em>optional</em>) – If true, then return mu as well.</p></li>
<li><p><strong>small_number</strong> (<em>float</em><em>, </em><em>optional</em>) – A small number to be included in the denominator to prevent             spikes when calculating the step size mu.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>new_coefs</strong> (<em>list or numpy.ndarray</em>) – The updated filter coefficients/weights.</p></li>
<li><p><strong>mu</strong> (<em>float</em>) – The step size used in this iteration. Only returns when returnmu             is set to True.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-kontrol.utils">
<span id="kontrol-utils-module"></span><h2>kontrol.utils module<a class="headerlink" href="#module-kontrol.utils" title="Permalink to this headline">¶</a></h2>
<p>Utility functions.</p>
<dl class="py function">
<dt id="kontrol.utils.norm2">
<code class="sig-prename descclassname">kontrol.utils.</code><code class="sig-name descname">norm2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spectrum</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.utils.norm2" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a spectrum and returns the 2-norm of the spectrum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>spectrum</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – The spectrum of interest</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>norm</strong> – The 2-norm of the spectrum</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="kontrol.utils.quad_sum">
<code class="sig-prename descclassname">kontrol.utils.</code><code class="sig-name descname">quad_sum</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">spectra</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.utils.quad_sum" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes any number of same length spectrum and returns the quadrature sum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>*spectra</strong> – Variable length argument list of the spectra.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>qs</strong> – The quadrature sum of the spectra.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="kontrol.utils.rms">
<code class="sig-prename descclassname">kontrol.utils.</code><code class="sig-name descname">rms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ts</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.utils.rms" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the RMS fluctuation of a given time series</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ts</strong> (<em>list of float</em><em> or </em><em>numpy.ndarray</em>) – The time series to be analyzed.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The RMS of the time series.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-kontrol.visutils">
<span id="kontrol-visutils-module"></span><h2>kontrol.visutils module<a class="headerlink" href="#module-kontrol.visutils" title="Permalink to this headline">¶</a></h2>
<p>KAGRA VIS system utility functions.</p>
<p>These methods are wrappers around Ezca and will interact with the real-time
systems. Any methods and interacts with the actual system falls into the
category of this visutils. Refer to other modules of Kontrol for other offline
methods.</p>
<dl class="py class">
<dt id="kontrol.visutils.Vis">
<em class="property">class </em><code class="sig-prename descclassname">kontrol.visutils.</code><code class="sig-name descname">Vis</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">ezca</span></em>, <em class="sig-param"><span class="n">ifo</span><span class="o">=</span><span class="default_value">'K1'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Utility functions for KAGRA VIS system.</p>
<p>Declare with the name of the optic. E.g. visutils.Vis(‘BS’).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>string</em>) – The name of the optic, e.g. ‘BS’.</p></li>
<li><p><strong>ezca</strong> (<em>module</em>) – Ezca module. Specify ezca for real-time usage and fakeezca for
testing.</p></li>
<li><p><strong>ifo</strong> (<em>string</em><em>, </em><em>optional</em>) – The interferometer site string. Defaults to ‘K1’</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="kontrol.visutils.Vis.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#kontrol.visutils.Vis.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the optic, e.g. ‘BS’.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="kontrol.visutils.Vis.ezcaObj">
<code class="sig-name descname">ezcaObj</code><a class="headerlink" href="#kontrol.visutils.Vis.ezcaObj" title="Permalink to this definition">¶</a></dt>
<dd><p>Ezca module specfied in parameter, initialized with the name of the                optic and the site string.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>module</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="kontrol.visutils.Vis.ifo">
<code class="sig-name descname">ifo</code><a class="headerlink" href="#kontrol.visutils.Vis.ifo" title="Permalink to this definition">¶</a></dt>
<dd><p>The interferometer site string. Defaults to ‘K1’</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="kontrol.visutils.Vis.snapshots">
<code class="sig-name descname">snapshots</code><a class="headerlink" href="#kontrol.visutils.Vis.snapshots" title="Permalink to this definition">¶</a></dt>
<dd><p>A temporary storage as snapshots take can be restored to the            real-time system.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict of {str:}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.actuator_diag">
<code class="sig-name descname">actuator_diag</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stage</span></em>, <em class="sig-param"><span class="n">dofs</span></em>, <em class="sig-param"><span class="n">act_block</span><span class="o">=</span><span class="default_value">'TEST'</span></em>, <em class="sig-param"><span class="n">act_suffix</span><span class="o">=</span><span class="default_value">'OFFSET'</span></em>, <em class="sig-param"><span class="n">sense_block</span><span class="o">=</span><span class="default_value">'DAMP'</span></em>, <em class="sig-param"><span class="n">sense_suffix</span><span class="o">=</span><span class="default_value">'INMON'</span></em>, <em class="sig-param"><span class="n">matrix</span><span class="o">=</span><span class="default_value">'EUL2COIL'</span></em>, <em class="sig-param"><span class="n">force</span><span class="o">=</span><span class="default_value">[]</span></em>, <em class="sig-param"><span class="n">no_of_coils</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">update_matrix</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">t_ramp</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">t_avg</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="o">=</span><span class="default_value">0.125</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.actuator_diag" title="Permalink to this definition">¶</a></dt>
<dd><p>Diagonalizing actuators in a stage by applying DC forces.</p>
<p>!!! INTERACTS WITH REAL SYSTEMS, USE WITH CAUTION !!!
Actuates a particular stage in its degrees of freedom to obtain the
stage-wise diagonalizaion actuation matrix. For now, the injection is
only DC. The default actuation channel is ‘K1:…TEST_OFFSET’ and the
default sensor channel is ‘K1:…DAMP_INMON’.
IMPORTANT: Do specify the force even though it is an optional argument.
This is to prevent the system to be violently perturbed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> (<em>string</em>) – The stage of interest in capatal letter. E.g. ‘BS’ or ‘ITMX’</p></li>
<li><p><strong>dofs</strong> (<em>list</em>) – A list of strings containing the degrees of freedom of the                 stage. e.g. [‘L’, ‘T’, ‘Y’]. The order must follow how the                 actuation matrix is arranged.</p></li>
<li><p><strong>act_block</strong> (<em>string</em><em>, </em><em>optional</em>) – The name of the block in the real-time system that is used for                the injection. Defaults to ‘TEST’ because it is usually used                 for such purpose.</p></li>
<li><p><strong>act_suffix</strong> (<em>string</em><em>, </em><em>optional</em>) – The suffix of the channel name which we inject the actuation                signal. Defaults to ‘OFFSET’.</p></li>
<li><p><strong>sense_block</strong> (<em>string</em><em>, </em><em>optional</em>) – The name of the block in the real-time system that is used to                measure readout. Note that the readouts must be diagonalized                beforehand in order for actuation diagonalization to work.                Defaults to ‘DAMP’</p></li>
<li><p><strong>sense_prefix</strong> (<em>string</em><em>, </em><em>optional</em>) – The suffix of the readout channel name. Defaults to ‘INMON’.            matrix: string, optional
The name of the block containing the actuation diagonalization                matrix entries. Defaults to ‘EUL2COIL’. The script
automatically checks if the stage uses EUL2COIL or EUL2OSEM
automatically. If other matrices is of interest, specify                 explicitly.</p></li>
<li><p><strong>force</strong> (<em>list of int</em><em> or </em><em>list of float</em><em>, </em><em>optional</em>) – The force in number of counts to put in the actuation                 channels. If not specified, the default no. of counts for all                 channels is 1000 counts. If more numbers are specified but                 less than the number of DoFs specified, then the rest will be                set to default. Note that this number is relative to any                additional offsets already present in the actuation channel.                E.g. if the actuation has originally 10 counts and a force of                10 counts is specified, the final number of counts will be 20.</p></li>
<li><p><strong>no_of_coils</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of actuators/coils of the stage. If not specified,                the scipt will guess from the number of rows of the actuation                matrix.</p></li>
<li><p><strong>update_matrix</strong> (<em>boolean</em><em>, </em><em>optional</em>) – If true, update the current matrix in the real-time system                 with the new one. Deefaults to False.</p></li>
<li><p><strong>t_ramp</strong> (<em>int</em><em> or </em><em>float</em>) – The ramp time in seconds for actuation. Defaults to 10.</p></li>
<li><p><strong>t_avg</strong> (<em>int</em><em> or </em><em>float</em>) – The averaging time for measuring the displacement readouts.</p></li>
<li><p><strong>dt</strong> (<em>int</em><em> or </em><em>float</em>) – The sampling spacing while measuring the average readouts.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>new_matrix</strong> – The final matrix to be entered to the actuation matrix.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.calming">
<code class="sig-name descname">calming</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">channels</span></em>, <em class="sig-param"><span class="n">rms_thresholds</span></em>, <em class="sig-param"><span class="n">t_int</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">dt</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.calming" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait if Ezca channels/PVs readouts are below given RMS thresholds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channels</strong> (<em>list of string</em>) – A list of channel names to be recorded</p></li>
<li><p><strong>rms_thresholds</strong> (<em>list of int</em><em> or </em><em>list of float</em>) – A list of RMS thresholds for the corresponding channels</p></li>
<li><p><strong>t_int</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Integration time for calculated the RMS in seconds.                Defaults to 5.</p></li>
<li><p><strong>dt</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Time space between each sample in seconds. Defaults to 1.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.find_sensor_correction_gain">
<code class="sig-name descname">find_sensor_correction_gain</code><span class="sig-paren">(</span><em class="sig-param">gain_channel='IP_SENSCORR_L_GAIN'</em>, <em class="sig-param">input_channel='IP_SENSCORR_L_INMON'</em>, <em class="sig-param">error_channel='IP_BLEND_ACCL_OUTPUT'</em>, <em class="sig-param">rms_threshold=0.01</em>, <em class="sig-param">t_int=10</em>, <em class="sig-param">dt=0.125</em>, <em class="sig-param">update_law=&lt;function nlms_update&gt;</em>, <em class="sig-param">step_size=0.5</em>, <em class="sig-param">step_size_limits=(0.001</em>, <em class="sig-param">1)</em>, <em class="sig-param">reducing_lms_step=False</em>, <em class="sig-param">reduction_ratio=0.99</em>, <em class="sig-param">timeout=300</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.find_sensor_correction_gain" title="Permalink to this definition">¶</a></dt>
<dd><p>Using LMS algorithms to find sensor correction gain.</p>
<p>!!! INTERACTS WITH REAL SYSTEMS, USE WITH CAUTION !!!
Using only when the system is under high gain feedback.
The function will directly tweak the sensor correction gain in the
real-time system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gain_channel</strong> (<em>string</em><em>, </em><em>optional</em>) – The sensor correction gain channel.</p></li>
<li><p><strong>input_channel</strong> (<em>string</em><em>, </em><em>optional</em>) – The input channel to the adaptive filter. Seismometer                displacement output in this case.</p></li>
<li><p><strong>error_channel</strong> (<em>string</em><em>, </em><em>optional</em>) – The error signal used in LMS algorithm to correct the adaptive                gain. The blended inertial sensor signal in this case.</p></li>
<li><p><strong>rms_threshold</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – The RMS threshold of the adaptive gain for termination of the                gain finding loop. Defaults to 0.01 (for 1% sensor correction                mismatch).</p></li>
<li><p><strong>t_int</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Integration time for calculated the RMS in seconds.                Defaults to 10 (roughly band-limited to above 0.1 Hz).</p></li>
<li><p><strong>dt</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Time space between each sample in seconds. Defaults to 1/8.            update_law: function, optional
LMS or normalized LMS algorithm for updating the sensor                correction gain. See kontrol.unsorted.                Defaults to kontrol.unsorted.nlms_update,                a Normalized LMS algorithm.</p></li>
<li><p><strong>step_size</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Step size to be used in the LMS algorithm. Defaults to be 0.5.</p></li>
<li><p><strong>step_size_limits</strong> (<em>tuple of</em><em> (</em><em>int</em><em> or </em><em>float</em><em>, </em><em>int</em><em> or </em><em>float</em><em>)</em><em>, </em><em>optinal</em>) – Lower and upper limit of the step size. Defaults to be (1e-3,                 1)</p></li>
<li><p><strong>reducing_lms_step</strong> (<em>boolean</em><em>, </em><em>optional</em>) – Allow reducing step size for better convergence. The step size                will be reduced by a factor of reduction_ratio when the cost                function (RMS of the error) remains the same or increased.
Defaults to be False.</p></li>
<li><p><strong>timeout</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Timeout for the loop in seconds. Defaults to be 300.</p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments that will be passed to update_law()</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>ts</strong> (<em>list of float</em>) – Time axis of the whole process.</p></li>
<li><p><strong>gains</strong> (<em>list of float</em>) – Sensor correction gain time series history.</p></li>
<li><p><strong>inputs</strong> (<em>list of float</em>) – Input time series.</p></li>
<li><p><strong>errors</strong> (<em>list of float</em>) – Error time series.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.read_avg">
<code class="sig-name descname">read_avg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">channels</span></em>, <em class="sig-param"><span class="n">t_avg</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="o">=</span><span class="default_value">0.125</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.read_avg" title="Permalink to this definition">¶</a></dt>
<dd><p>Read and calculate time-averaged of given Ezca channels/PVs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channels</strong> (<em>list of string</em>) – A list of channel names to be measured.</p></li>
<li><p><strong>t_avg</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – The averaging time for measuring the displacement readouts.</p></li>
<li><p><strong>dt</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – The sampling spacing while measuring the average readouts.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>x0</strong> – a list of average values read from the specified channels.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.read_matrix">
<code class="sig-name descname">read_matrix</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stage</span></em>, <em class="sig-param"><span class="n">matrix</span></em>, <em class="sig-param"><span class="n">i</span></em>, <em class="sig-param"><span class="n">j</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.read_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a single entry from a real-time model matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> (<em>string</em>) – The stage of interest, e.g. ‘IP’.</p></li>
<li><p><strong>matrix</strong> (<em>string</em>) – The matrix to be measured, e.g. ‘EUL2COIL’.</p></li>
<li><p><strong>i</strong> (<em>int</em>) – Row index, counting from 1.</p></li>
<li><p><strong>j</strong> (<em>int</em>) – Column index, counting from 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The measured value from the EPICs record.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.restore_snapshots">
<code class="sig-name descname">restore_snapshots</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">channels</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.restore_snapshots" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore snapshots taken by Vis.take_snapshots().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>channels</strong> (<em>list of string</em>) – The channels/PVs to be restored</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="kontrol.visutils.Vis.take_snapshots">
<code class="sig-name descname">take_snapshots</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">channels</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kontrol.visutils.Vis.take_snapshots" title="Permalink to this definition">¶</a></dt>
<dd><p>Take snapshots and store as a dictionary in Vis.snapshots().</p>
<p>Snaps can later be restored by Vis.restore_snapshots().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>channels</strong> (<em>list of string</em>) – The channels/PVs to be stored</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-kontrol">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-kontrol" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contact.html" class="btn btn-neutral float-right" title="Contact" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="modules.html" class="btn btn-neutral float-left" title="Library Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, TSANG Terrence Tak Lun

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>